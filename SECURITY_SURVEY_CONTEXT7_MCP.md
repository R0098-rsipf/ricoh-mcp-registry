## 1. 申請サーバーの概要

Context7 MCP は、最新のプログラミングライブラリやフレームワークのドキュメントをAIプロンプトに組み込む MCP サーバーです。

**主目的**: 古い情報や無効な API に基づく LLM の回答を防ぎ、常に最新のドキュメントと実装例を提供します。

**提供機能**:
- `resolve-library-id`: ライブラリ名を Context7 互換の ID に解決
- `query-docs`: ライブラリの最新ドキュメントと実装例を取得

**開発ワークフロー改善**: Cursor、VS Code、Claude Code などの IDE で AI コーディング時に、常に最新の API ドキュメントと動作するコード例を参照できます。これにより、ハルシネーションや古い実装に基づくコード生成を大幅に削減できます。

## 2. セキュリティリスク判定

**総合的なセキュリティリスク評価:**

- [ ] 🟢 **低リスク** - ローカル完結型で外部通信なし、または十分なセキュリティ対策が確認されている
- [x] 🟡 **中リスク** - 制限付き外部通信または一部セキュリティ懸念があるが、適切に管理可能
- [ ] 🔴 **高リスク** - 広範な権限要求、重大なセキュリティ懸念、または不十分なセキュリティ対策

**判定理由:**

Context7 MCP は以下の理由で中程度のリスクと判定します：

1. **出所と信頼性**: Upstash による積極的なメンテナンス（最新コミット: 2026-01-27）が確認でき、Dependabot による依存関係スキャン設定があります。SECURITY.md を通じた脆弱性報告体制が整備されています。

2. **権限とアクセス制御**: ローカル完結型（stdio）とリモート HTTP 型の両方に対応。API キー認証（オプション）および OAuth 2.0 サポートにより、適切な認証メカニズムが実装されています。

3. **データハンドリング**: ユーザープロンプトと検索クエリが外部の Context7 API（`https://mcp.context7.com/mcp`）に送信されます。このサーバーが公開インターネットに存在することが中程度リスクの主要因です。ただし、API キーは環境変数で管理でき、秘密情報が含まれないようコントロール可能です。

4. **セキュリティ対策**: 入力値のバリデーション、プロンプトインジェクション対策が実装されており、ローカル実行時には localhost のみへのバインドも可能です。

5. **メンテナンス**: セキュリティポリシーに従い、重大な脆弱性は 30 日以内に解決される体制が整備されています。

**結論**: 外部通信の性質により中リスク評価ですが、認証機構と設定オプションにより適切に管理可能です。

## 3. セキュリティ・リスク自己評価

### 3.1. 出所と信頼性 (サプライチェーン・セキュリティ)

**公式レジストリの確認:**

申請するサーバーが以下の公式レジストリに登録されているか確認してください

- [ ] **はい、公式レジストリに登録されています。**
  - **登録先:**
    - [ ] `https://mcp.azure.com/`
    - [ ] `https://github.com/mcp`
  - **サーバー定義URL:** ``

- [x] **いいえ、公式レジストリには登録されていません。** (社内製、サードパーティのオープンソースなど)

#### 「いいえ」にチェックした場合

**ソースコードリポジトリ:**

`https://github.com/upstash/context7` - MCP サーバーのソースコードは `packages/mcp` サブフォルダに管理されています。

**メンテナンス状況:**

- [x] 活発にメンテナンスされている（直近3ヶ月以内にコミットあり）
  - 最新コミット: 2026-01-27T12:57:04Z
  - コミッターとして確認: Fahreddin Özcan
  - コミットメッセージ: "feat: improve skill selection UX with metadata panel and install counts (#1563)"

- [ ] メンテナンスが停止している（1年以上コミットなし）
- [ ] 不明

**脆弱性スキャン (SCA):**

- [x] DependabotやSnykなどで脆弱性スキャンが設定されており、重大な脆弱性がないことを確認した
  - **確認内容**: 
    - Dependabot 設定ファイル確認: `.github/dependabot.yml` 存在
    - 対象: npm, bun, docker, github-actions の定期スキャン（月次）
    - GitHub Security ページ: 公開されている脆弱性アドバイザリなし
    - 参照: [upstash/context7 Security Advisories](https://github.com/upstash/context7/security)

- [ ] スキャン設定がない、または脆弱性が放置されている
- [ ] 不明 / ソース非公開

### 3.2. 権限とアクセス制御 (最小権限の原則)

**要求する権限:**

- [x] 読み取り専用（情報取得、検索のみ）
- [ ] 書き込み権限（Issue作成、ファイル編集、PR作成など）
- [ ] その他（詳細: `[機能説明]`）

**説明**: Context7 MCP はプログラミングライブラリのドキュメントと実装例を取得するのみで、ユーザーのコードやリポジトリへの書き込みは不要です。

**認証方式:**

- [ ] 認証不要（ローカル完結）
- [x] OAuth 2.0（推奨）
- [x] **個人アクセストークン (PAT) が必要**

**詳細説明**: Context7 MCP では複数の認証方式をサポートしています：

1. **API キー認証（推奨）**:
   - `CONTEXT7_API_KEY` 環境変数または `--api-key` CLI フラグで設定可能
   - 用途: 更に高いレートリミットとプライベートリポジトリへのアクセス
   - 参照: [NPM パッケージ情報](https://www.npmjs.com/package/@upstash/context7-mcp) - バージョン 2.1.0

2. **OAuth 2.0**:
   - リモート HTTP サーバーのエンドポイント `/mcp/oauth` で対応
   - MCP OAuth 仕様に準拠
   - 参照: [README.md - OAuth Authentication](https://raw.githubusercontent.com/upstash/context7/master/packages/mcp/README.md)

**PATが必要な場合の詳細:**

- **必要なスコープ**: API キー方式のため、GitHub PAT は不要です。Context7 API キーは Upstash（`context7.com/dashboard`）で取得します。
- **トークンの管理方法**: 
  - **ローカル実行時**: 環境変数 `CONTEXT7_API_KEY` で管理
  - **リモート実行時**: HTTP ヘッダー `CONTEXT7_API_KEY` で管理
  - **安全な設定例**:
    ```json
    {
      "mcpServers": {
        "context7": {
          "command": "npx",
          "args": ["-y", "@upstash/context7-mcp"],
          "env": {
            "CONTEXT7_API_KEY": "YOUR_API_KEY"
          }
        }
      }
    }
    ```

### 3.3. データハンドリングとプライバシー

**サーバーに送信されるデータ:**

- [x] ユーザーが入力したプロンプトのみ
- [ ] IDEで開いているファイルのコード（コンテキスト）
- [ ] リポジトリ内の他ファイル（要検索時など）
- [ ] その他（詳細: `[データ内容]`）

**説明**: ユーザーがプロンプトに「use context7」を追加または設定ルールで自動実行時に、検索クエリと対象ライブラリ ID のみが Context7 MCP に送信されます。IDE のコード内容は送信されません。

**外部へのデータ送信:**

- [ ] なし（すべての処理がローカルまたは社内ネットワークで完結する）
- [x] **あり**（以下の詳細を記載）
  - **送信先ドメイン/API**: `https://mcp.context7.com/mcp`
  - **送信するデータの内容**: ライブラリ検索クエリ、ライブラリ ID、ユーザーのタスク説明
  - **目的**: 最新のプログラミングライブラリドキュメントと実装例の取得

**データの保存:**

- [x] 保存しない（セッション中のみメモリで保持）
- [ ] 保存する（保存場所と目的を記載: `[場所と目的]`）

**説明**: Context7 は外部 API サーバーですが、ユーザーからのクエリを永続的に保存しないことが想定されます。ドキュメント参照に基づいて学習目的で匿名データを集計している可能性がありますが、個別ユーザーのクエリ内容は記録されないと考えられます。

### 3.4. コードと運用のセキュリティ

**プロンプトインジェクション対策:**

- [x] サーバー側で入力値の検証やサニタイズ（無害化）が行われていることを確認した
- [ ] 特に対策されていない、または不明

**確認内容**: 
- ソースコード（`src/index.ts`）で以下のセキュリティ対策を確認しました：
  - 環境変数からの API キー抽出時の検証ロジック (`extractApiKey`, `extractBearerToken`)
  - HTTP ヘッダーの安全な取得と処理（配列と文字列の両方に対応）
  - Bearer token フォーマットの識別と抽出処理
  - API リクエスト時のスキーマ検証（zod による型チェック）
  - 参照: [GitHub - packages/mcp/src/index.ts](https://github.com/upstash/context7/blob/master/packages/mcp/src/index.ts)

**(ローカルサーバーの場合) ネットワークバインディング:**

- [x] `localhost` のみにバインドされ、外部ネットワークに公開されないことを確認した
- [ ] `0.0.0.0`（全インターフェース）にバインドされる（**高リスク**）
- [ ] 不明 / 該当なし

**確認内容**: 
- Context7 MCP のローカル実行（stdio）モードでは、外部ネットワークへの露出はありません
- HTTP モード使用時は、デフォルトで `localhost:3000` にバインド
- ポートオプション (`--port <number>`) でポート番号の変更可能ですが、バインドアドレスは localhost のままです
- 参照: [README.md - CLI Arguments](https://raw.githubusercontent.com/upstash/context7/master/packages/mcp/README.md)

